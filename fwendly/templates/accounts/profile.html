{% extends 'base.html' %}
{% block content %}
<div style="position:relative;">
  <!-- ðŸŒ„ Background image -->
  <div style="width:100%; height:200px; border-radius:8px; overflow:hidden; background:#e5e7eb;">
    {% if profile.background %}
      <img src="{{ profile.background.url }}" alt="Background" style="width:100%; height:100%; object-fit:cover;">
    {% else %}
      <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#777;">
        No background photo
      </div>
    {% endif %}
  </div>

  <!-- ðŸ‘¤ Profile details -->
  <div style="display:flex;gap:1.5rem;align-items:flex-start; margin-top:-60px; padding:1rem; background:white; border-radius:8px;">
    <div>
      {% if profile.photo %}
        <img src="{{ profile.photo.url }}" class="profile-photo" alt="photo" style="width:140px;height:140px;border-radius:50%;border:4px solid white;">
      {% else %}
        <div style="width:140px;height:140px;border-radius:50%;background:#e5e7eb;display:flex;align-items:center;justify-content:center;border:4px solid white;">
          No photo
        </div>
      {% endif %}
    </div>

    <div style="flex:1;">
      <h2 style="margin:0;">{{ profile.user.username }}</h2>
      <div class="small" style="margin-bottom:0.5rem;"><strong>Location:</strong> {{ profile.location }}</div>
      <p><strong>Bio:</strong> {{ profile.bio|linebreaks }}</p>
      {% if profile.interests %}<p class="small"><strong>Interests:</strong> {{ profile.interests }}</p>{% endif %}
      {% if profile.visibility == 'public' %}
        <p class="small"><strong>Visibility:</strong> Public</p>
      {% elif profile.visibility == 'private' %}
        <p class="small"><strong>Visibility:</strong> Private</p>
      {% elif profile.visibility == 'friends' %}
        <p class="small"><strong>Visibility:</strong> Friends Only</p>
      {% endif %}

      <a href="{% url 'profile_edit' %}" class="btn btn-blue">Edit Profile</a>
      {% if user == profile.user %}
        <!-- âœ… Show only to the profile owner -->
        <a href="{% url 'create_post' %}" class="btn btn-green">+ Create Post</a>
      {% endif %}
      <!-- âœ… Mutual Friends Section -->
      
      {% if mutual_count is not None %}
      <hr style="margin:1rem 0;">
      <h3>You and {{ profile.user.username }} have {{ mutual_count }} mutual friend{{ mutual_count|pluralize }}.</h3>

      {% if mutual_count > 0 %}
        <ul>
          {% for mf in mutual %}
            <li>{{ mf.user.username }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endif %}
    </div>
  </div>
</div>


<!-- â­ Testimonials -->
<div style="margin-top:1.5rem;">
  <h3>Testimonials</h3>
  {% for t in testimonials %}
    <div class="card" style="margin-bottom:0.5rem;">
      <div style="font-weight:600;">{{ t.author.username }} 
        <span class="small" style="font-weight:400;">â€” {{ t.created_at|date:'M d, Y' }}</span>
      </div>
      <div style="margin-top:0.5rem;">{{ t.content }}</div>
    </div>
  {% empty %}
    <p>No testimonials yet.</p>
  {% endfor %}
  <a class="small" href="{% url 'testimonial_list' profile.user.username %}">View all testimonials</a>
</div>

<!-- ðŸ–¼ï¸ User Posts -->
<div style="margin-top:2rem;">
  <h3>Posts</h3>
  {% for post in profile.user.posts.all %}
    <div class="card" style="margin-bottom:1rem;">
      <img src="{{ post.image.url }}" alt="Post image" style="width:100%;border-radius:8px;">
      {% if post.caption %}
        <p style="margin-top:0.5rem;">{{ post.caption }}</p>
      {% endif %}
      <p class="small" style="color:#888;">{{ post.created_at|date:"M d, Y H:i" }}</p>
    </div>
  {% empty %}
    <p>No posts yet.</p>
  {% endfor %}
  <a href="{% url 'user_posts' profile.user.username %}" class="btn btn-ghost">View All Posts</a>
</div>
{% endblock %}
