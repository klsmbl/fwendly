{% extends 'base.html' %}
{% block content %}
<div style="position:relative;">
  <!-- ðŸŒ„ Background image -->
  <div style="width:100%; height:460px; border-radius:12px; overflow:hidden; background:#e5e7eb;">
    {% if profile.background %}
      <img src="{{ profile.background.url }}" alt="Background" style="width:100%; height:100%; object-fit:cover;">
    {% else %}
      <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#777;">
        No background photo
      </div>
    {% endif %}
  </div>

  <!-- ðŸ‘¤ Floating Profile Photo -->
  <div style="position:absolute; top:500px; left:2rem; z-index:2;">
    {% if profile.photo %}
      <img src="{{ profile.photo.url }}" alt="Profile photo"
           style="width:150px; height:150px; border-radius:50%; border:5px solid white; object-fit:cover; box-shadow:0 4px 12px rgba(0,0,0,0.15);">
    {% else %}
      <div style="width:150px; height:150px; border-radius:50%; background:#e5e7eb; display:flex; align-items:center; justify-content:center; border:5px solid white; box-shadow:0 4px 12px rgba(0,0,0,0.15);">
        No photo
      </div>
    {% endif %}
  </div>

  <!-- ðŸ“„ Profile details -->
  <div style="margin-top:1rem; padding:1.5rem; background:white; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
    <div style="margin-left:180px;"> <!-- Push text to the right of the floating photo -->
      <h2 style="margin:0;">{{ profile.user.username }}</h2>
      <div class="small" style="margin-bottom:0.5rem;">
        <strong>Location:</strong> {{ profile.location }}
      </div>
      <p class="small"><strong> Bio:</strong> {{ profile.bio }}</p>
      {% if profile.interests %}
        <p class="small"><strong>Interests:</strong> {{ profile.interests }}</p>
      {% endif %}
      {% if profile.visibility == 'public' %}
        <p class="small"><strong>Visibility:</strong> Public</p>
      {% elif profile.visibility == 'private' %}
        <p class="small"><strong>Visibility:</strong> Private</p>
      {% elif profile.visibility == 'friends' %}
        <p class="small"><strong>Visibility:</strong> Friends Only</p>
      {% endif %}

      <a href="{% url 'profile_edit' %}" class="btn btn-blue">Edit Profile</a>
      {% if user == profile.user %}
        <!-- âœ… Show only to the profile owner -->
        <a href="{% url 'create_post' %}" class="btn btn-green">+ Create Post</a>
      {% endif %}
    </div>
  </div>
</div>


<!-- â­ Testimonials -->
<div style="margin-top:2rem;">
  <h3>Testimonials</h3>
  {% for t in testimonials %}
    <div class="card" style="margin-bottom:0.5rem;">
      <div style="font-weight:600;">{{ t.author.username }} 
        <span class="small" style="font-weight:400;">â€” {{ t.created_at|date:'M d, Y' }}</span>
      </div>
      <div style="margin-top:0.5rem;">{{ t.content }}</div>
    </div>
  {% empty %}
    <p>No testimonials yet.</p>
  {% endfor %}
  <a class="small" href="{% url 'testimonial_list' profile.user.username %}">View all testimonials</a>
</div>

<!-- ðŸ–¼ï¸ User Posts -->
<div style="margin-top:2rem;">
  <h3>Posts</h3>

  <div style="
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:1rem;
  ">
    {% for post in profile.user.posts.all %}
      <div class="card" style="overflow:hidden; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        <img src="{{ post.image.url }}" alt="Post image" style="width:100%; height:200px; object-fit:cover;">

        <div style="padding:0.75rem;">
          {% if post.caption %}
            <p style="margin:0; font-size:0.9rem; color:#333;">{{ post.caption|truncatechars:60 }}</p>
          {% endif %}
          <p class="small" style="color:#888; margin-top:0.25rem;">
            {{ post.created_at|date:"M d, Y H:i" }}
          </p>
        </div>
      </div>
    {% empty %}
      <p>No posts yet.</p>
    {% endfor %}
  </div>

  <div style="margin-top:1rem; text-align:center;">
    <a href="{% url 'user_posts' profile.user.username %}" class="btn btn-ghost">View All Posts</a>
  </div>
</div>

{% endblock %}
