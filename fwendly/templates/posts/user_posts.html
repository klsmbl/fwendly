{% extends "base.html" %}
{% block content %}
<h2>{{ user.username }}‚Äôs Posts</h2>

<div style="margin-top:1rem;">
  {% for post in posts %}
    <div class="card" style="margin-bottom:1rem; padding:1rem;">
      <!-- üì∏ Post Image -->
      <img src="{{ post.image.url }}" alt="Post image" style="width:100%;border-radius:8px;">

      <!-- üìù Caption -->
      {% if post.caption %}
        <p style="margin-top:0.5rem;">{{ post.caption }}</p>
      {% endif %}
      <p class="small" style="color:#888;">{{ post.created_at|date:"M d, Y H:i" }}</p>

        <!-- ‚ù§Ô∏è Like Button -->
    {% if user.is_authenticated %}
    <form method="post" action="{% url 'toggle_post_like' post.id %}" style="display:inline;">
    {% csrf_token %}
    {% if post.liked_by_user %}
        <button type="submit" class="btn btn-gray">‚ù§Ô∏è Unlike ({{ post.likes.count }})</button>
    {% else %}
        <button type="submit" class="btn btn-red">ü§ç Like ({{ post.likes.count }})</button>
    {% endif %}
    </form>
    {% else %}
    <p class="small" style="color:#888;">{{ post.likes.count }} likes</p>
    {% endif %}


      <!-- üí¨ Comments -->
      <div style="margin-top:0.75rem; border-top:1px solid #ddd; padding-top:0.5rem;">
        {% for c in post.comments.all %}
          <p class="small" style="margin:0.25rem 0;">
            <strong>{{ c.author.username }}</strong>: {{ c.content }}
            <span class="small" style="color:#888;">({{ c.created_at|date:"M d, Y H:i" }})</span>
          </p>
        {% empty %}
          <p class="small" style="color:#888;">No comments yet.</p>
        {% endfor %}

        <!-- ‚úçÔ∏è Add Comment -->
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'add_post_comment' post.id %}" style="margin-top:0.5rem;">
            {% csrf_token %}
            <textarea name="content" rows="1" placeholder="Write a comment..." style="width:100%;"></textarea>
            <button type="submit" class="btn btn-ghost">Comment</button>
          </form>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p>No posts yet.</p>
  {% endfor %}
</div>
{% endblock %}
